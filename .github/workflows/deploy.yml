name: Build and Deploy

on:
  push:
    branches: [main]

env:
  OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
  VEGVESEN_API_KEY: ${{ secrets.VEGVESEN_API_KEY }}
  # Andre secrets her

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      # Sett opp Docker Buildx for multi-arch om nødvendig
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v2

      # Logg inn på Docker Hub eller annen registry (hvis publisering ønskes)
      # - name: Log in to Docker Hub
      #   uses: docker/login-action@v2
      #   with:
      #     username: ${{ secrets.DOCKER_USERNAME }}
      #     password: ${{ secrets.DOCKER_PASSWORD }}

      # Bygg og start containerne med riktig .env
      - name: Build and run containers
        run: |
          echo "OPENAI_API_KEY=${{ secrets.OPENAI_API_KEY }}" >> .env
          echo "VEGVESEN_API_KEY=${{ secrets.VEGVESEN_API_KEY }}" >> .env
          docker-compose up -d --build

      # Eventuelt: Push til remote server via SSH, scp, rsync osv
      # Her må du tilpasse basert på deploy-metode (f.eks. Scaleway,Netlify )
