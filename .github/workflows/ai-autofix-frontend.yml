name: Automatisk AI-kodefiks for frontend-tester

on:
  workflow_dispatch:  # Manuell triggering
  workflow_run:
    workflows: ["full-pipeline"]
    types:
      - completed

jobs:
  ai_autofix_frontend:
    runs-on: ubuntu-latest
    if: always()    # <-- Kjør alltid, selv om forrige workflow var OK!
    steps:
      - name: Sjekk ut repo
        uses: actions/checkout@v3

      - name: Sett opp Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Installer dependencies
        working-directory: ./frontend
        run: |
          npm install
          npm install openai

      - name: Kjør AI autofix for frontend
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        working-directory: ./frontend
        run: |
          node ../scripts/ai_autofix_js.py

      - name: Push rettede filer (hvis noen ble endret)
        run: |
          git config --global user.name "AI Autofix Bot"
          git config --global user.email "ai-bot@elbatt.no"
          git add .
          git commit -m "AI-autofix: Rettet frontend-feil automatisk med OpenAI" || echo "Ingenting å commite"
          git push origin main
